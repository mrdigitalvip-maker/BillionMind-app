<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BillionMind - Seu Futuro Milion√°rio</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importa√ß√£o de √çcones (Phosphor Icons - solicitado pelo usu√°rio) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Fonte Inter do Google (padr√£o Tailwind, mas garantida) -->

    <!-- Bloco de Importa√ß√£o e Configura√ß√£o do Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, setDoc, updateDoc, arrayUnion, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Vari√°veis globais obrigat√≥rias no ambiente Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "MOCK_API_KEY",
            authDomain: "MOCK_AUTH_DOMAIN",
            projectId: "MOCK_PROJECT_ID",
            storageBucket: "MOCK_STORAGE_BUCKET",
            messagingSenderId: "MOCK_SENDER_ID",
            appId: "MOCK_APP_ID"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;
        let userId = null;
        let isAuthReady = false;

        // Fun√ß√µes exportadas para o escopo global do script regular
        window.firebaseInit = async function() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // 1. Autentica√ß√£o
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // 2. Listener de Estado de Autentica√ß√£o
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        console.log("Firebase Auth OK. User ID:", userId);
                        window.renderProfile();
                        window.renderHabits();
                    } else {
                        // Tratar desautentica√ß√£o
                        userId = null;
                        isAuthReady = true;
                        window.renderProfile(); // Renderizar com dados mock se deslogado
                    }
                });
            } catch (error) {
                console.error("Erro na inicializa√ß√£o do Firebase:", error);
            }
        };

        window.db = db; // Exportar db para ser usado em outras fun√ß√µes

        // Fun√ß√£o de salvar h√°bito (Firestore)
        window.saveHabit = async function(habitData) {
            if (!userId) { console.error("Usu√°rio n√£o autenticado."); return; }
            if (!db) { console.error("Firestore n√£o inicializado."); return; }

            const userHabitsRef = collection(db, `artifacts/${appId}/users/${userId}/habits`);
            try {
                // Usa setDoc com um ID gerado automaticamente se n√£o for fornecido, ou um ID espec√≠fico
                const habitId = habitData.id || crypto.randomUUID();
                await setDoc(doc(userHabitsRef, habitId), {
                    ...habitData,
                    createdAt: new Date().toISOString(),
                    completed: false,
                    userId: userId
                });
                console.log("H√°bito salvo com sucesso:", habitId);
            } catch (e) {
                console.error("Erro ao adicionar h√°bito:", e);
            }
        };

        // Fun√ß√£o de atualizar perfil (Firestore)
        window.updateProfile = async function(updates) {
            if (!userId) { console.error("Usu√°rio n√£o autenticado."); return; }
            if (!db) { console.error("Firestore n√£o inicializado."); return; }

            const profileRef = doc(db, `artifacts/${appId}/users/${userId}/profile/data`);
            try {
                await setDoc(profileRef, updates, { merge: true });
                console.log("Perfil atualizado:", updates);
            } catch (e) {
                console.error("Erro ao atualizar perfil:", e);
            }
        };

        // Fun√ß√£o de update (usada para completar h√°bito)
        window.updateHabit = async function(habitId, updates) {
            if (!userId) { console.error("Usu√°rio n√£o autenticado."); return; }
            if (!db) { console.error("Firestore n√£o inicializado."); return; }

            const habitRef = doc(db, `artifacts/${appId}/users/${userId}/habits`, habitId);
            try {
                await updateDoc(habitRef, updates);
                console.log("H√°bito atualizado:", habitId, updates);
            } catch (e) {
                console.error("Erro ao atualizar h√°bito:", e);
            }
        };

        // Listener de h√°bitos para renderiza√ß√£o
        window.renderHabits = function() {
            if (!isAuthReady || !userId || !db) return;

            const habitsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/habits`);
            const q = query(habitsCollectionRef, where("completed", "==", false)); // Apenas h√°bitos n√£o conclu√≠dos

            onSnapshot(q, (snapshot) => {
                const habitsList = document.getElementById('habits-list');
                if (!habitsList) return;

                habitsList.innerHTML = '';
                if (snapshot.empty) {
                    habitsList.innerHTML = `<p class="text-gray-500 italic text-center py-4">Nenhuma Rotina de Elite ativa. Use o Alpha.AI para criar!</p>`;
                    return;
                }

                snapshot.docs.forEach(docSnap => {
                    const habit = docSnap.data();
                    const habitId = docSnap.id;
                    
                    // Renderiza o card de h√°bito (modelo da Aba Hoje)
                    const habitCard = `
                        <div class="glass-card p-4 rounded-xl flex items-center justify-between hover:bg-white/10">
                            <div class="flex items-center space-x-4">
                                <button onclick="window.completeHabit('${habitId}')" class="w-6 h-6 border-2 border-yellow-500 rounded-full flex-shrink-0 hover:bg-yellow-500/20 transition"></button>
                                <div>
                                    <p class="font-semibold text-lg text-white">${habit.name || 'Nova Meta'}</p>
                                    <p class="text-sm text-gray-400">${habit.time || 'Aguardando execu√ß√£o'} - ${habit.description || 'Foco na Alta Performance.'}</p>
                                </div>
                            </div>
                            <i class="ph ph-zap-fill w-5 h-5 icon-neon"></i>
                        </div>
                    `;
                    habitsList.innerHTML += habitCard;
                });
            }, (error) => {
                console.error("Erro ao receber updates de h√°bitos:", error);
            });
        };
    </script>
    <!-- FIM DO BLOCO FIREBASE -->

    <style>
        /* Cores e Estilos Globais Premium */
        :root {
            --color-black-prime: #0a0a0a;
            --color-gold: #F2C94C; /* Dourado */
            --color-neon-purple: #9B51E0; /* Roxo Neon */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-black-prime);
            color: #E5E7EB; /* Branco elegante */
        }

        /* Glassmorphism Base (Containers Principais) */
        .glass-card {
            background-color: rgba(255, 255, 255, 0.05); /* Leve transpar√™ncia */
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5); /* Sombra intensa */
            transition: all 0.3s ease;
        }

        /* Bot√£o Dourado Premium (CTA) */
        .btn-gold {
            background-image: linear-gradient(to right, var(--color-gold) 0%, #FFD700 100%);
            color: var(--color-black-prime);
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(242, 201, 76, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(242, 201, 76, 0.8);
        }

        /* Estilo para √çcones Neon Roxo */
        .icon-neon {
            color: var(--color-neon-purple);
            filter: drop-shadow(0 0 4px var(--color-neon-purple));
        }

        /* Estilo para Abas Ativas na Navega√ß√£o Inferior */
        .nav-item.active {
            color: var(--color-gold);
            filter: drop-shadow(0 0 6px var(--color-gold));
        }

        /* Estilo para o Badge VIP Dourado */
        .badge-vip {
            background-color: var(--color-gold);
            color: var(--color-black-prime);
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 9999px;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            box-shadow: 0 0 8px rgba(242, 201, 76, 0.8);
        }

        /* Esconder abas inativas */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Container Principal do Aplicativo -->
    <div id="app-container" class="flex flex-col flex-grow w-full max-w-md mx-auto relative">

        <!-- Header Fixo (Nome do App Centralizado + Subt√≠tulo + VIP) -->
        <header class="p-4 flex justify-between items-center glass-card z-30 border-b border-white/20">
            <!-- Centraliza√ß√£o do T√≠tulo e Subt√≠tulo -->
            <div class="flex-grow flex flex-col items-center">
                <h1 class="text-3xl font-extrabold tracking-widest text-yellow-400 filter drop-shadow-[0_0_8px_rgba(242,201,76,0.8)]">
                    <span class="icon-neon">Billion</span>Mind
                </h1>
                <!-- Subt√≠tulo Elegante e Discreto -->
                <p class="text-xs text-gray-400 mt-1 italic">Sua rotina. Seu poder. Seu futuro milion√°rio.</p>
            </div>
            <!-- Badge VIP (mantido √† direita) -->
            <button onclick="showVipModal()" class="flex items-center space-x-2 badge-vip absolute right-4 top-4">
                <i class="ph ph-crown-simple text-black"></i>
                <span id="vip-status">PRO</span>
            </button>
        </header>

        <!-- Conte√∫do das Abas (Scrollable Area) -->
        <main class="flex-grow overflow-y-auto p-4 space-y-6">

            <!-- 1. ABA HOJE (The Elite Day) -->
            <section id="tab-hoje" class="tab-content active">
                <div class="space-y-6">
                    <!-- Status Bars -->
                    <div class="grid grid-cols-3 gap-3">
                        <div class="p-3 glass-card rounded-xl text-center">
                            <p class="text-xs text-gray-400 uppercase">XP (Execu√ß√£o)</p>
                            <p id="profile-xp" class="text-2xl font-bold text-green-400 mt-1">1800</p>
                        </div>
                        <div class="p-3 glass-card rounded-xl text-center">
                            <p class="text-xs text-gray-400 uppercase">Energy (Foco)</p>
                            <p id="profile-energy" class="text-2xl font-bold text-red-400 mt-1">75%</p>
                        </div>
                        <div class="p-3 glass-card rounded-xl text-center">
                            <p class="text-xs text-gray-400 uppercase">Status</p>
                            <p class="text-xl font-bold mt-1 text-white badge-vip">
                                LEO
                            </p>
                        </div>
                    </div>

                    <!-- Frase Di√°ria de Mentalidade Milion√°ria -->
                    <div class="glass-card p-4 rounded-xl border-l-4 border-l-yellow-500">
                        <p class="text-lg font-semibold text-yellow-400 mb-2">Frase de Elite (28 Nov)</p>
                        <p class="text-white italic">"Seus h√°bitos de hoje s√£o o alicerce do seu primeiro milh√£o. A disciplina √© o custo do luxo."</p>
                    </div>

                    <!-- Carrossel de Depoimentos -->
                    <h2 class="text-2xl font-bold text-white mb-4 border-b border-gray-700 pb-2">Resultados de Elite</h2>
                    <div id="testimonial-carousel" class="relative w-full overflow-hidden mb-6 h-28">
                        <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out h-full">
                            <!-- Depoimentos ser√£o renderizados aqui pelo JS -->
                        </div>
                        <div id="carousel-dots" class="flex justify-center space-x-2 mt-2 absolute bottom-0 w-full"></div>
                    </div>
                    
                    <!-- Rotina de Elite -->
                    <h2 class="text-2xl font-bold text-white mb-4 border-b border-gray-700 pb-2">Rotina de Elite: Alta Performance</h2>
                    <div id="habits-list" class="space-y-3">
                        <!-- Cards de H√°bito ser√£o renderizados pelo JS (onSnapshot) -->
                        <div class="glass-card p-4 rounded-xl flex items-center justify-between hover:bg-white/10">
                            <div class="flex items-center space-x-4">
                                <button onclick="completeHabit('mock-1')" class="w-6 h-6 border-2 border-yellow-500 rounded-full flex-shrink-0 hover:bg-yellow-500/20 transition"></button>
                                <div>
                                    <p class="font-semibold text-lg text-white">Leitura Estrat√©gica</p>
                                    <p class="text-sm text-gray-400">06:00 - 30 mins sobre mercado.</p>
                                </div>
                            </div>
                            <i class="ph ph-zap-fill w-5 h-5 icon-neon"></i>
                        </div>
                    </div>

                    <!-- Card de Conclus√£o da Rotina -->
                    <div class="p-4 bg-gray-700/50 rounded-xl text-center">
                        <p class="text-gray-400">Voc√™ est√° 70% no Caminho do Milh√£o hoje. Mantenha a Disciplina!</p>
                    </div>
                </div>
            </section>

            <!-- 2. ABA PLANEJAR (Strategic Ascent) -->
            <section id="tab-planejar" class="tab-content">
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-white border-b border-gray-700 pb-2">Planejamento Estrat√©gico</h2>

                    <!-- Bot√£o de Cria√ß√£o de Alto N√≠vel (usando AlphaAI) -->
                    <button onclick="showAlphaAIModal()" class="w-full btn-gold py-3 rounded-xl flex items-center justify-center space-x-2">
                        <i class="ph ph-brain-fill w-5 h-5 text-black"></i>
                        <span>DEIXAR ALPHA.AI CRIAR MEU PLANO HOJE</span>
                    </button>

                    <!-- Lista de Desafios (Cards) -->
                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Desafios de Riqueza Ativos</h3>
                    <div class="space-y-4">
                        <!-- Card 1: Desafio -->
                        <div class="glass-card p-4 rounded-xl">
                            <h4 class="text-xl font-bold text-yellow-400">Dominando a Renda Passiva</h4>
                            <p class="text-sm text-gray-400 mb-2">Desafio: 30 dias de estudo e aplica√ß√£o em cripto/im√≥veis.</p>
                            <div class="flex justify-between items-center text-sm mt-3">
                                <span class="flex items-center space-x-1 text-blue-400"><i class="ph ph-layers-fill w-4 h-4"></i><span>N√≠vel: Elite</span></span>
                                <span class="flex items-center space-x-1 text-gray-400"><i class="ph ph-users-fill w-4 h-4"></i><span>1.2K L√≠deres</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Categorias de Cria√ß√£o -->
                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Crie com Alpha.AI</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="generateAlphaAIContent('H√°bito de Riqueza')" class="glass-card p-4 rounded-xl text-center hover:border-yellow-500 transition border-2 border-transparent">
                            <i class="ph ph-clock-fill w-6 h-6 icon-neon mx-auto mb-1"></i>
                            <p class="text-sm font-semibold">Novo H√°bito</p>
                        </button>
                        <button onclick="generateAlphaAIContent('Rotina de Alta Performance')" class="glass-card p-4 rounded-xl text-center hover:border-yellow-500 transition border-2 border-transparent">
                            <i class="ph ph-calendar-check-fill w-6 h-6 icon-neon mx-auto mb-1"></i>
                            <p class="text-sm font-semibold">Rotina de Elite</p>
                        </button>
                        <button onclick="generateAlphaAIContent('Meta Financeira 7-D√≠gitos')" class="glass-card p-4 rounded-xl text-center hover:border-yellow-500 transition border-2 border-transparent">
                            <i class="ph ph-currency-dollar-fill w-6 h-6 icon-neon mx-auto mb-1"></i>
                            <p class="text-sm font-semibold">Meta Financeira</p>
                        </button>
                        <button onclick="generateAlphaAIContent('Desafio Pessoal')" class="glass-card p-4 rounded-xl text-center hover:border-yellow-500 transition border-2 border-transparent">
                            <i class="ph ph-fire-fill w-6 h-6 icon-neon mx-auto mb-1"></i>
                            <p class="text-sm font-semibold">Desafio VIP</p>
                        </button>
                    </div>

                    <!-- Mensagem de Sucesso da Cria√ß√£o (Toast Placeholder) -->
                    <div id="ai-toast" class="p-3 bg-green-900/50 rounded-lg text-green-300 text-center hidden"></div>
                </div>
            </section>

            <!-- 3. ABA AMIGOS (Inner Circle) -->
            <section id="tab-amigos" class="tab-content">
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-white border-b border-gray-700 pb-2">Seu C√≠rculo de Elite</h2>
                    
                    <p class="text-gray-400">Networking √© Net-Worth. Conecte-se apenas com quem est√° no caminho do topo.</p>
                    
                    <!-- Bot√£o para Adicionar Amigo (Estilo VIP) -->
                    <button class="w-full btn-gold py-3 rounded-xl flex items-center justify-center space-x-2">
                        <i class="ph ph-user-plus-fill w-5 h-5 text-black"></i>
                        <span>ADICIONAR NO C√çRCULO VIP</span>
                    </button>

                    <!-- Ranking de Disciplina (Novo Elemento) -->
                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Ranking de Disciplina Global</h3>
                    <div class="glass-card p-4 rounded-xl space-y-3">
                        <div class="flex justify-between items-center text-yellow-400 font-bold">
                            <span>#1 | Marcus S.</span> <span>XP: 5800</span>
                        </div>
                        <div class="flex justify-between items-center text-white">
                            <span>#2 | Vivian I.</span> <span>XP: 4900</span>
                        </div>
                        <div class="flex justify-between items-center text-white">
                            <span>#3 | Voc√™ (LEO)</span> <span>XP: 1800</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. ABA MENU (Control Center) -->
            <section id="tab-menu" class="tab-content">
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-white border-b border-gray-700 pb-2">Control Center</h2>

                    <!-- ALPHA.AI CHAT INTEGRADO -->
                    <div class="glass-card p-4 rounded-xl border-2 border-purple-500">
                        <h3 class="text-xl font-bold mb-2 flex items-center space-x-2 text-purple-400">
                            <i class="ph ph-brain-fill w-6 h-6 icon-neon"></i>
                            <span>Alpha.AI: Seu Coach Milion√°rio</span>
                        </h3>
                        <div id="alpha-ai-chat-history" class="bg-black/50 p-3 rounded-lg max-h-40 overflow-y-auto mb-3 text-sm text-gray-300">
                            <p class="text-yellow-400 mb-1">Alpha.AI:</p>
                            <p>Pronto para maximizar seu potencial. Qual √© o seu objetivo financeiro mais agressivo hoje?</p>
                        </div>
                        <div class="flex space-x-2">
                            <input id="alpha-ai-input" type="text" placeholder="Pergunte ao Alpha.AI..." class="flex-grow p-2 rounded-lg bg-gray-700/50 text-white placeholder-gray-500 focus:ring-1 focus:ring-purple-500 focus:outline-none text-sm">
                            <button onclick="sendAlphaAIChat()" class="bg-purple-600 p-2 rounded-lg hover:bg-purple-700 transition"><i class="ph ph-paper-plane-right-fill w-4 h-4 text-white"></i></button>
                        </div>
                    </div>

                    <!-- Itens do Menu (Lista) -->
                    <div class="space-y-2">
                        <a onclick="showVipModal()" class="cursor-pointer flex justify-between items-center glass-card p-3 rounded-xl hover:bg-white/10">
                            <span class="flex items-center space-x-3 text-white">
                                <i class="ph ph-trophy-fill w-5 h-5 icon-neon"></i>
                                <span>Conte√∫do VIP e Exclusivo</span>
                            </span>
                            <i class="ph ph-caret-right-fill w-5 h-5 text-gray-500"></i>
                        </a>
                        <a href="#" class="flex justify-between items-center glass-card p-3 rounded-xl hover:bg-white/10">
                            <span class="flex items-center space-x-3 text-white">
                                <i class="ph ph-chart-line-up-fill w-5 h-5 icon-neon"></i>
                                <span>√çndice de Potencial Humano (IPH)</span>
                            </span>
                            <span class="text-sm text-yellow-400">92%</span>
                        </a>
                        <!-- ... outros itens do menu ... -->
                    </div>
                </div>

                <!-- Se√ß√£o de Planos VIP (Acesso R√°pido) -->
                <div class="mt-8">
                    <h3 class="text-xl font-bold text-yellow-400 mb-3 border-b border-gray-700 pb-2">Maximizando Seu Acesso (Planos)</h3>
                    
                    <!-- Contador de Urg√™ncia -->
                    <div id="urgency-counter" class="glass-card p-3 rounded-xl text-center mb-6 border-2 border-red-500 animate-pulse">
                        <p class="text-sm font-semibold text-red-400">üî• <span id="active-users">23</span> pessoas est√£o ativando o BillionMind agora.</p>
                    </div>

                    <div class="space-y-4">
                        
                        <!-- Plano Gr√°tis -->
                        <div class="glass-card p-4 rounded-xl border-l-4 border-gray-500">
                            <p class="font-semibold text-lg">Plano Gr√°tis (Mindset B√°sico)</p>
                            <p class="text-sm text-gray-400">Acesso limitado a rotinas e Chat IA simples.</p>
                            <p class="text-xs text-yellow-600 mt-1 italic">Recursos limitados ‚Äî ideal para come√ßar hoje.</p>
                            <button class="mt-2 text-sm text-purple-400 font-semibold hover:underline">Detalhes</button>
                        </div>

                        <!-- Plano Pro -->
                        <div class="glass-card p-4 rounded-xl border-l-4 border-purple-500">
                            <p class="font-semibold text-lg flex justify-between items-center">
                                <span>Plano Pro</span>
                                <span class="text-purple-400">R$ 29,98/m√™s</span>
                            </p>
                            <p class="text-sm text-gray-400">IA Intermedi√°ria, h√°bitos e rotinas ilimitadas, dashboards completos.</p>
                            <p class="text-xs text-purple-400 mt-1 italic">Mais vendido ‚Äî desbloqueie a performance completa.</p>
                            <button onclick="subscribePro()" class="mt-3 w-full bg-purple-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-purple-700 transition">Assinar Plano Pro</button>
                        </div>

                        <!-- Plano VIP (Dourado) -->
                        <div class="glass-card p-4 rounded-xl border-l-4 border-yellow-500">
                            <p class="font-semibold text-lg flex justify-between items-center">
                                <span>Plano VIP <span class="badge-vip">Master</span></span>
                                <span class="text-yellow-400">R$ 39,98/m√™s</span>
                            </p>
                            <p class="text-sm text-gray-400">Alpha.AI avan√ßado (Coach Milion√°rio), Rotinas de Elite, Acesso Total, Badge Dourado.</p>
                            <p class="text-xs text-yellow-400 mt-1 italic">Acesso total ‚Äî vagas limitadas por per√≠odo.</p>
                            <button onclick="subscribeVIP()" class="mt-3 w-full btn-gold py-2 rounded-lg text-sm">ASSINAR PLANO VIP</button>
                        </div>

                    </div>
                </div>
            </section>
        </main>

        <!-- Navega√ß√£o Inferior Fixa (Bottom Navbar) -->
        <nav class="p-2 glass-card flex justify-around items-center z-20 border-t border-white/20 sticky bottom-0">
            <!-- Bot√£o Hoje -->
            <button class="nav-item active flex flex-col items-center p-2" onclick="switchTab('hoje', this)">
                <i class="ph ph-house-fill w-6 h-6"></i>
                <span class="text-xs mt-1 font-medium">Hoje</span>
            </button>
            <!-- Bot√£o Planejar -->
            <button class="nav-item flex flex-col items-center p-2" onclick="switchTab('planejar', this)">
                <i class="ph ph-target-fill w-6 h-6"></i>
                <span class="text-xs mt-1 font-medium">Planejar</span>
            </button>
            <!-- Bot√£o Amigos -->
            <button class="nav-item flex flex-col items-center p-2" onclick="switchTab('amigos', this)">
                <i class="ph ph-users-fill w-6 h-6"></i>
                <span class="text-xs mt-1 font-medium">Amigos</span>
            </button>
            <!-- Bot√£o Menu -->
            <button class="nav-item flex flex-col items-center p-2" onclick="switchTab('menu', this)">
                <i class="ph ph-list-fill w-6 h-6"></i>
                <span class="text-xs mt-1 font-medium">Menu</span>
            </button>
        </nav>

        <!-- MODAL VIP (Requisito: Modal VIP) -->
        <div id="vip-modal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4" onclick="hideVipModal()">
            <div class="glass-card bg-gray-900/90 p-6 rounded-xl w-full max-w-sm" onclick="event.stopPropagation()">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Upgrade para Elite</h3>
                    <button onclick="hideVipModal()" class="text-gray-400 hover:text-white"><i class="ph ph-x-circle-fill w-6 h-6"></i></button>
                </div>
                <p class="text-gray-300 mb-6">Desbloqueie o poder total do Alpha.AI para seu caminho milion√°rio.</p>
                <!-- Repeti√ß√£o dos planos, garantindo os bot√µes do Stripe -->
                <div class="space-y-4">
                     <!-- Plano Pro -->
                    <div class="glass-card p-4 rounded-xl border-l-4 border-purple-500">
                        <p class="font-semibold text-lg flex justify-between items-center">
                            <span>Plano Pro</span>
                            <span class="text-purple-400">R$ 29,98/m√™s</span>
                        </p>
                        <p class="text-xs text-purple-400 mt-1 italic">Mais vendido ‚Äî desbloqueie a performance completa.</p>
                        <button onclick="subscribePro()" class="mt-3 w-full bg-purple-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-purple-700 transition">Assinar Plano Pro</button>
                    </div>

                    <!-- Plano VIP (Dourado) -->
                    <div class="glass-card p-4 rounded-xl border-l-4 border-yellow-500">
                        <p class="font-semibold text-lg flex justify-between items-center">
                            <span>Plano VIP <span class="badge-vip">Master</span></span>
                            <span class="text-yellow-400">R$ 39,98/m√™s</span>
                        </p>
                        <p class="text-xs text-yellow-400 mt-1 italic">Acesso total ‚Äî vagas limitadas por per√≠odo.</p>
                        <button onclick="subscribeVIP()" class="mt-3 w-full btn-gold py-2 rounded-lg text-sm">ASSINAR PLANO VIP</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL ALPHA.AI (Requisito: Modal AlphaAI) -->
        <div id="alpha-ai-modal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4" onclick="hideAlphaAIModal()">
            <div class="glass-card bg-gray-900/90 p-6 rounded-xl w-full max-w-lg" onclick="event.stopPropagation()">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-2xl font-bold text-purple-400">Alpha.AI Creator</h3>
                    <button onclick="hideAlphaAIModal()" class="text-gray-400 hover:text-white"><i class="ph ph-x-circle-fill w-6 h-6"></i></button>
                </div>
                
                <p id="ai-modal-status" class="text-sm text-gray-400 mb-4">Crie h√°bitos, rotinas e metas de alta performance com a IA.</p>
                <input id="ai-modal-input" type="text" placeholder="Ex: Crie um h√°bito de investimento di√°rio." class="w-full p-3 rounded-lg bg-gray-700/50 text-white placeholder-gray-500 focus:ring-1 focus:ring-purple-500 focus:outline-none mb-4">
                
                <button onclick="generateAlphaAIContent('Personalizado')" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition flex items-center justify-center space-x-2">
                    <i class="ph ph-sparkle-fill w-5 h-5"></i>
                    <span>Gerar Conte√∫do de Elite</span>
                </button>

                <div id="ai-modal-output" class="mt-4 p-3 bg-black/50 rounded-lg max-h-40 overflow-y-auto text-sm text-gray-300">
                    <!-- Output da IA aqui -->
                    <p class="text-gray-500">O conte√∫do gerado pelo Alpha.AI aparecer√° aqui. Clique em "Gerar"!</p>
                </div>
                <button id="ai-modal-save-btn" onclick="saveGeneratedContent()" class="mt-3 w-full btn-gold py-2 rounded-lg text-sm hidden">SALVAR ESTE CONTE√öDO (HABIT/ROTINA)</button>
            </div>
        </div>

    </div>

    <!-- JavaScript para L√≥gica do App, Carrossel, Modais e Integra√ß√µes -->
    <script>
        // Vari√°veis de estado
        let currentTab = 'hoje';
        const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Ser√° preenchido pelo Canvas em runtime

        // Dados Mock para Carrossel
        const TESTIMONIALS = [
            { text: "Aumentei minha disciplina em 300% em 7 dias.", author: "Leandro V." },
            { text: "Esse app mudou meu foco para sempre.", author: "Helena R." },
            { text: "Meu planejamento financeiro nunca foi t√£o claro.", author: "Marcos D." },
            { text: "O AlphaAI me d√° tarefas perfeitas para meu objetivo di√°rio.", author: "Lucas M." },
            { text: "Estou no caminho para o meu primeiro milh√£o.", author: "Vitor S." },
        ];
        let carouselIndex = 0;

        // --- FUN√á√ïES DE UI E NAVEGA√á√ÉO ---

        /**
         * Alterna a visibilidade das abas e atualiza o estado da navega√ß√£o.
         * @param {string} tabId O ID da aba (ex: 'hoje', 'planejar').
         * @param {HTMLElement} element O bot√£o de navega√ß√£o clicado.
         */
        function switchTab(tabId, element) {
            // Esconde todo o conte√∫do das abas
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Mostra o conte√∫do da aba selecionada
            const targetTab = document.getElementById(`tab-${tabId}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }

            // Atualiza o estado da navega√ß√£o inferior
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            
            currentTab = tabId;
        }

        /**
         * Simula a renderiza√ß√£o do perfil (XP, Energy) - Usaria dados do Firestore.
         */
        function renderProfile() {
            // Simula√ß√£o de renderiza√ß√£o de perfil com dados iniciais ou do Firestore
            document.getElementById('profile-xp').textContent = '2500';
            document.getElementById('profile-energy').textContent = '90%';
            document.getElementById('vip-status').textContent = 'VIP Master';
        }

        /**
         * Fun√ß√£o para marcar um h√°bito como completo e salvar no Firestore.
         * @param {string} habitId ID do h√°bito a ser completado.
         */
        window.completeHabit = async function(habitId) {
            console.log(`Tentando completar h√°bito: ${habitId}`);
            if (typeof window.updateHabit === 'function') {
                await window.updateHabit(habitId, { completed: true, completedAt: new Date().toISOString() });
                const toast = document.getElementById('ai-toast');
                toast.textContent = `H√°bito ${habitId} conclu√≠do! +XP!`;
                toast.classList.remove('hidden', 'bg-red-900/50', 'text-red-300');
                toast.classList.add('bg-green-900/50', 'text-green-300');
                setTimeout(() => toast.classList.add('hidden'), 3000);
            } else {
                console.error("Fun√ß√£o updateHabit n√£o est√° dispon√≠vel (Firebase n√£o carregado?).");
            }
        };

        // --- FUN√á√ïES DE MODAIS ---

        function showVipModal() {
            document.getElementById('vip-modal').classList.remove('hidden');
        }

        function hideVipModal() {
            document.getElementById('vip-modal').classList.add('hidden');
        }

        function showAlphaAIModal(itemType) {
            document.getElementById('ai-modal-status').textContent = itemType ? `Crie sua ${itemType} de Elite.` : 'Crie h√°bitos, rotinas e metas de alta performance com a IA.';
            document.getElementById('ai-modal-input').value = itemType ? `Gerar ${itemType} para o meu objetivo de 7 d√≠gitos.` : '';
            document.getElementById('ai-modal-output').innerHTML = '<p class="text-gray-500">O conte√∫do gerado pelo Alpha.AI aparecer√° aqui. Clique em "Gerar"!</p>';
            document.getElementById('ai-modal-save-btn').classList.add('hidden');
            document.getElementById('alpha-ai-modal').classList.remove('hidden');
        }

        function hideAlphaAIModal() {
            document.getElementById('alpha-ai-modal').classList.add('hidden');
        }

        // --- FUN√á√ïES DE ANIMA√á√ÉO E ESTADO ---

        /**
         * Inicia o carrossel de depoimentos autom√°tico.
         */
        function startTestimonialCarousel() {
            const track = document.getElementById('carousel-track');
            const dotsContainer = document.getElementById('carousel-dots');
            const itemWidth = document.getElementById('testimonial-carousel').clientWidth;

            // 1. Renderiza os itens e os pontos
            track.innerHTML = TESTIMONIALS.map((t, i) => `
                <div class="glass-card p-4 rounded-xl flex-shrink-0 w-full h-full flex flex-col justify-center border-l-4 border-purple-500" style="width: ${itemWidth}px;">
                    <p class="text-sm italic text-white/90">"${t.text}"</p>
                    <p class="text-xs text-yellow-400 font-semibold mt-1">‚Äî ${t.author}</p>
                </div>
            `).join('');

            dotsContainer.innerHTML = TESTIMONIALS.map((_, i) => `
                <span data-index="${i}" class="w-2 h-2 rounded-full bg-gray-600 transition duration-300 ${i === 0 ? 'bg-yellow-400' : ''}"></span>
            `).join('');

            // 2. Fun√ß√£o de transi√ß√£o
            const moveCarousel = () => {
                carouselIndex = (carouselIndex + 1) % TESTIMONIALS.length;
                track.style.transform = `translateX(-${carouselIndex * itemWidth}px)`;

                // Atualiza pontos
                document.querySelectorAll('#carousel-dots span').forEach((dot, i) => {
                    if (i === carouselIndex) {
                        dot.classList.add('bg-yellow-400');
                        dot.classList.remove('bg-gray-600');
                    } else {
                        dot.classList.remove('bg-yellow-400');
                        dot.classList.add('bg-gray-600');
                    }
                });
            };

            // 3. Inicia o intervalo
            setInterval(moveCarousel, 4000);
        }

        /**
         * Inicia a anima√ß√£o do contador de urg√™ncia.
         */
        function startUrgencyCounter() {
            const counterElement = document.getElementById('active-users');
            if (counterElement) {
                let count = 23;
                setInterval(() => {
                    const delta = Math.floor(Math.random() * 3) - 1; // +1, 0, ou -1
                    count = Math.max(20, count + delta); // Mant√©m o m√≠nimo de 20
                    counterElement.textContent = count;
                }, 1500);
            }
        }

        // --- FUN√á√ïES ALPHA.AI (GEMINI API) ---

        let generatedContentCache = null;

        /**
         * Simula o envio de mensagem para o Alpha.AI (Chat).
         */
        async function sendAlphaAIChat() {
            const input = document.getElementById('alpha-ai-input');
            const history = document.getElementById('alpha-ai-chat-history');
            const userQuery = input.value.trim();

            if (!userQuery) return;
            
            // Adiciona mensagem do usu√°rio
            history.innerHTML += `<p class="text-white mt-2">Voc√™: ${userQuery}</p>`;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            // Simula loading
            const loadingMsg = document.createElement('p');
            loadingMsg.className = 'text-gray-500 italic mt-2';
            loadingMsg.innerHTML = 'Alpha.AI est√° formulando a resposta...';
            history.appendChild(loadingMsg);
            history.scrollTop = history.scrollHeight;

            const systemPrompt = "Voc√™ √© Alpha.AI, um coach de mentalidade milion√°ria, alta performance e disciplina. Responda como um mentor de riqueza, com foco em a√ß√µes estrat√©gicas, financeiras e de elite. Seja conciso e direto ao ponto.";
            
            try {
                // Call the Gemini API (Exponential Backoff implemented implicitly by environment)
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                const response = await fetch(`${GEMINI_API_URL}${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const aiResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "Erro: N√£o consegui processar sua mentalidade agora. Tente novamente.";
                
                // Remove loading
                loadingMsg.remove();

                // Adiciona resposta da IA
                history.innerHTML += `<p class="text-yellow-400 mt-2">Alpha.AI:</p><p>${aiResponse}</p>`;
                history.scrollTop = history.scrollHeight;
                
            } catch (error) {
                console.error("Erro na chamada da Gemini API:", error);
                loadingMsg.textContent = "Erro de conex√£o com o Alpha.AI. Tente novamente mais tarde.";
            }
        }

        /**
         * Gera conte√∫do estruturado (H√°bito/Rotina/Meta) para o Modal Alpha.AI.
         * @param {string} itemType Tipo de conte√∫do a ser gerado (H√°bito de Riqueza, Rotina de Elite, etc.).
         */
        async function generateAlphaAIContent(itemType) {
            const input = document.getElementById('ai-modal-input').value.trim();
            const output = document.getElementById('ai-modal-output');
            const saveBtn = document.getElementById('ai-modal-save-btn');
            
            // Se chamado pelo bot√£o de Planejar, abre o modal
            if (itemType !== 'Personalizado') {
                 showAlphaAIModal(itemType);
                 document.getElementById('ai-modal-input').value = input || `Gerar ${itemType} para o meu objetivo de 7 d√≠gitos.`;
            }
            
            const userPrompt = `Gerar um item de alta performance para o usu√°rio com foco em riqueza. Tipo do item: ${itemType}. Detalhe do usu√°rio: ${input}. Formate a resposta como um objeto JSON: {"name": "Nome da A√ß√£o", "description": "Descri√ß√£o da A√ß√£o/Foco", "time": "Hor√°rio/Dura√ß√£o", "type": "${itemType}", "details": "Instru√ß√µes do Coach"}`;
            
            output.innerHTML = '<p class="text-purple-400 italic">Alpha.AI est√° otimizando sua rotina...</p>';
            saveBtn.classList.add('hidden');
            
            const systemPrompt = "Voc√™ √© Alpha.AI. Sua tarefa √© criar um √∫nico item de alta performance (h√°bito, rotina, meta) em portugu√™s. Sua resposta deve ser *somente* o objeto JSON, e o conte√∫do deve ser de um coach milion√°rio de elite. O hor√°rio e a descri√ß√£o devem ser precisos.";

            try {
                // Call the Gemini API for structured output
                const payload = {
                    contents: [{ parts: [{ text: userPrompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "name": { "type": "STRING", "description": "Nome conciso e poderoso para o h√°bito/meta." },
                                "description": { "type": "STRING", "description": "Descri√ß√£o breve da a√ß√£o e foco." },
                                "time": { "type": "STRING", "description": "Hor√°rio ou dura√ß√£o da a√ß√£o (e.g., '07:00' ou '30 mins')." },
                                "type": { "type": "STRING", "enum": ["H√°bito de Riqueza", "Rotina de Elite", "Meta Financeira 7-D√≠gitos", "Desafio Pessoal"] },
                                "details": { "type": "STRING", "description": "Instru√ß√µes detalhadas e motivacionais do coach." }
                            },
                            required: ["name", "description", "time", "type", "details"]
                        }
                    },
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                const response = await fetch(`${GEMINI_API_URL}${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                let generatedData = JSON.parse(jsonText);

                generatedContentCache = generatedData;

                output.innerHTML = `
                    <p class="text-yellow-400 font-bold">${generatedData.name} (${generatedData.type})</p>
                    <p class="text-sm text-gray-400 mt-1">Hor√°rio: ${generatedData.time}</p>
                    <p class="text-sm text-white italic mt-2">${generatedData.description}</p>
                    <p class="mt-3 border-t border-gray-700 pt-2 text-xs">${generatedData.details}</p>
                `;
                saveBtn.classList.remove('hidden');

            } catch (error) {
                console.error("Erro na gera√ß√£o de conte√∫do estruturado pela IA:", error);
                output.innerHTML = `<p class="text-red-400">Alpha.AI: Erro na gera√ß√£o. Tente formatar sua requisi√ß√£o de forma mais clara.</p>`;
                generatedContentCache = null;
            }
        }

        /**
         * Salva o conte√∫do gerado pela IA no Firestore (H√°bito/Rotina).
         */
        function saveGeneratedContent() {
            if (!generatedContentCache) {
                alert("Nenhum conte√∫do v√°lido da IA para salvar.");
                return;
            }

            // O objeto gerado j√° √© o formato do h√°bito
            window.saveHabit(generatedContentCache);

            const toast = document.getElementById('ai-toast');
            toast.textContent = `Conte√∫do ${generatedContentCache.name} salvo como prioridade!`;
            toast.classList.remove('hidden', 'bg-red-900/50', 'text-red-300');
            toast.classList.add('bg-green-900/50', 'text-green-300');
            setTimeout(() => toast.classList.add('hidden'), 3000);
            
            hideAlphaAIModal();
            generatedContentCache = null; // Limpa o cache
        }


        // --- FUN√á√ïES DE CHECKOUT (STRIPE MOCK) ---

        /**
         * Fun√ß√µes mock do Stripe, conforme solicitado.
         * NOTA: Estas fun√ß√µes requerem um endpoint de backend (/api/checkout) real para funcionar,
         * mas est√£o estruturadas exatamente como solicitado.
         */
        async function subscribe(priceId) {
            const res = await fetch("/api/checkout", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ priceId })
            });

            const data = await res.json();
            if (data.url) {
                window.location.href = data.url;
            } else {
                console.error("Erro no checkout:", data);
                const toast = document.getElementById('ai-toast');
                toast.textContent = `Erro ao iniciar checkout do Stripe.`;
                toast.classList.remove('hidden', 'bg-green-900/50', 'text-green-300');
                toast.classList.add('bg-red-900/50', 'text-red-300');
                setTimeout(() => toast.classList.add('hidden'), 5000);
            }
        }

        function subscribePro() {
            // price_1SYaniARia0ROQXBL4xAFQBo
            subscribe("price_1SYaniARia0ROQXBL4xAFQBo");
        }

        function subscribeVIP() {
            // price_1SYaspARia0ROQXBunnpCkml
            subscribe("price_1SYaspARia0ROQXBunnpCkml");
        }

        // --- INICIALIZA√á√ÉO GERAL ---

        window.onload = () => {
             // 1. Inicializa o Firebase e autentica
             if (typeof window.firebaseInit === 'function') {
                window.firebaseInit();
             } else {
                console.warn("Firebase Init n√£o encontrado. Usando dados mock.");
                const initialButton = document.querySelector('.nav-item');
                if(initialButton) {
                    switchTab('hoje', initialButton);
                }
                renderProfile();
             }

             // 2. Inicia as anima√ß√µes de UI
             startTestimonialCarousel();
             startUrgencyCounter();
        };

    </script>
</body>
</html>
